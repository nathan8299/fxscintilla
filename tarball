#! /bin/bash

# usage:
#		tarball devel|release [<scintilla_release> [<minor_release>]]
# example:
#		tarball release 1_40 3
# produces
#		snapshot/fxscintilla-1.40.3.tgz

if [ "$1" = "devel" ]; then
		devel=true
else
		devel=false
fi
	
major=$2
minor=$3

# Name
name="fxscintilla-"
if [ ! -z $major ]; then
		name="${name}"`echo $major | sed 's/_/./'`
		if [ ! -z $minor ]; then
				name="${name}.${minor}"
		fi
else
		name="${name}cvs"
fi

# Tag
if [ ! -z $major ]; then
		tag="FXSCINTILLA-${major}"
		if [ ! -z $minor ]; then
				tag="${tag}_${minor}"
		fi
else
		tag="HEAD"
fi


if [ ! -d snapshot ]; then
	mkdir snapshot
fi
cd snapshot

rm -fr fxscintilla
cvs -w export -r "${tag}" fxscintilla

find fxscintilla/scintilla -type f ! \( \
		-name 'Makefile.*' -o \
		-name '*.png' -o \
		-name '*.ico' -o \
		-name '*.cur' -o \
		-name '*.jpg' -o \
		-name '*.bmp' \) \
	-exec unix2dos -o {} \;

cd fxscintilla

if [ "$devel" = "false" ]; then
		rm -fr test scintilla/gtk scintilla/win32
		rm -f scintilla.kdevprj
		rm -f scintilla/scintilla.dsp
		rm -f scintilla/scintilla.dsw
		rm -f scintilla/fox/scintilla.dsp
		rm -f scintilla/fox/scintilla.dsw
fi

cd ..
mv fxscintilla $name
tar cvzf ${name}.tgz $name
mv $name fxscintilla

ls -l ${name}.tgz
cd ..
